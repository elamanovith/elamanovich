<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Elamanovich ‚Äî –õ–∏—á–Ω–∞—è –≥–∞–ª–µ—Ä–µ—è</title>
<style>
  :root{
    --bg:#f7f7f8; --card:#ffffff; --muted:#6b7280; --accent:#0b69ff; --shadow: 0 6px 18px rgba(15,23,42,0.06);
  }
  body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:#111827; margin:0;}
  header{background:var(--card); padding:18px 20px; display:flex; align-items:center; justify-content:space-between; box-shadow:var(--shadow); position:sticky; top:0; z-index:10;}
  h1{margin:0; font-size:18px;}
  .subtitle{color:var(--muted); font-size:13px;}
  main{max-width:1100px; margin:28px auto; padding:0 16px;}
  .controls{display:flex; gap:8px; align-items:center; margin-bottom:18px;}
  .btn{background:var(--accent); color:white; padding:8px 12px; border-radius:8px; border:0; cursor:pointer;}
  .btn.ghost{background:transparent; color:var(--accent); border:1px solid rgba(11,105,255,0.12);}
  .panel{background:var(--card); padding:16px; border-radius:12px; box-shadow:var(--shadow); margin-bottom:16px;}
  .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:12px;}
  .thumb{background:linear-gradient(90deg, #fff, #f8fafc); padding:8px; border-radius:10px; overflow:hidden; display:flex; flex-direction:column; gap:8px; align-items:center; text-align:center;}
  .thumb img{width:100%; height:120px; object-fit:cover; border-radius:8px;}
  .meta{font-size:13px; color:var(--muted); overflow:hidden; white-space:nowrap; text-overflow:ellipsis; width:100%;}
  .modal{position:fixed; inset:0; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; padding:20px; z-index:50;}
  .card{background:var(--card); padding:16px; border-radius:12px; max-width:1000px; width:100%; max-height:90vh; overflow:auto; box-shadow:0 10px 40px rgba(2,6,23,0.15);}
  label{display:block; font-weight:600; margin-top:8px; font-size:13px;}
  input[type="text"], textarea, select{width:100%; padding:10px; border-radius:8px; border:1px solid #e6e9ef; margin-top:6px; box-sizing:border-box; font-size:14px;}
  textarea{min-height:80px; resize:vertical;}
  .row{display:flex; gap:8px;}
  .row .col{flex:1;}
  footer{color:var(--muted); text-align:center; margin:24px 0 60px;}
  .small{font-size:12px; color:var(--muted);}
  .top-actions{display:flex; gap:8px; align-items:center;}
  .search{padding:8px 12px; border-radius:10px; border:1px solid #e6e9ef; width:220px;}
  .hidden{display:none;}
  .tag{background:#eef6ff; color:var(--accent); padding:6px 8px; border-radius:10px; font-size:12px;}
  .danger{background:#ffeef0; color:#d32f2f; border:1px solid rgba(211,47,47,0.08);}
  @media (max-width:600px){ .grid{grid-template-columns:repeat(2,1fr);} }
</style>
</head>
<body>
<header>
  <div>
    <h1>Elamanovich</h1>
    <div class="subtitle">–õ–∏—á–Ω–∞—è –≥–∞–ª–µ—Ä–µ—è ‚Äî –∑–∞–∫—Ä—ã—Ç–∞—è ‚Ä¢ —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</div>
  </div>
  <div class="top-actions">
    <input id="search" class="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é">
    <div id="userStatus" class="small">üîí –ó–∞–∫—Ä—ã—Ç–æ</div>
  </div>
</header>

<main>
  <div class="panel">
    <div class="controls">
      <button class="btn" id="btnAddPhoto">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
      <button class="btn" id="btnAddVideo">–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ</button>
      <button class="btn ghost" id="btnImport">–ò–º–ø–æ—Ä—Ç JSON</button>
      <button class="btn ghost" id="btnExport">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
      <button class="btn ghost danger" id="btnClear">–û—á–∏—Å—Ç–∏—Ç—å (–ª–æ–∫–∞–ª—å–Ω–æ)</button>
      <div style="flex:1"></div>
      <button class="btn ghost" id="btnSettings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>
    <div class="small">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –∑–∞–≥—Ä—É–∂–∞–π —Ñ–∞–π–ª—ã –≤ Google Drive/pCloud ‚Üí —Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É "–¥–æ—Å—Ç—É–ø –ø–æ —Å—Å—ã–ª–∫–µ" ‚Üí –≤—Å—Ç–∞–≤–ª—è–π URL –∫–∞–∫ "–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª". –§–∞–π–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤ —Ç–≤–æ—ë–º –æ–±–ª–∞–∫–µ, —Å–∞–π—Ç –ª–∏—à—å –∏—Ö –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç.</div>
  </div>

  <div class="panel">
    <h3>–§–æ—Ç–æ</h3>
    <div id="photos" class="grid"></div>
  </div>

  <div class="panel">
    <h3>–í–∏–¥–µ–æ</h3>
    <div id="videos" class="grid"></div>
  </div>

  <div class="panel">
    <h3>–ê—Ä—Ö–∏–≤</h3>
    <div id="archive" class="grid"></div>
  </div>

  <footer>
    <div>–°–∞–π—Ç Elamanovich ‚Äî –ª–∏—á–Ω–∞—è –≥–∞–ª–µ—Ä–µ—è. –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –≤ —Ç–≤–æ—ë–º –æ–±–ª–∞–∫–µ.</div>
    <div class="small">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –¥–µ–ª–∞–π —ç–∫—Å–ø–æ—Ä—Ç JSON –∫–∞–∫ –±—ç–∫–∞–ø —Ä–∞–∑ –≤ –º–µ—Å—è—Ü.</div>
  </footer>
</main>

<!-- Modals -->
<div id="modalLock" class="modal hidden">
  <div class="card">
    <h2>–î–æ—Å—Ç—É–ø –∫ Elamanovich</h2>
    <div class="small">–≠—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω–∞—è –≥–∞–ª–µ—Ä–µ—è. –ï—Å–ª–∏ —Ç—ã –≤–ø–µ—Ä–≤—ã–µ, —Å–æ–∑–¥–∞–π –ø–∞—Ä–æ–ª—å. –ü–∞—Ä–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ç–≤–æ—ë–º –±—Ä–∞—É–∑–µ—Ä–µ (localStorage).</div>
    <label>–ü–∞—Ä–æ–ª—å</label>
    <input id="pwInput" type="password" autocomplete="new-password" placeholder="–ü—Ä–∏–¥—É–º–∞–π –ø–∞—Ä–æ–ª—å..."/>
    <div style="margin-top:12px; display:flex; gap:8px;">
      <button class="btn" id="pwSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤–æ–π—Ç–∏</button>
      <button class="btn ghost" id="pwCancel">–í—ã–π—Ç–∏</button>
    </div>
  </div>
</div>

<div id="modalAdd" class="modal hidden">
  <div class="card">
    <h3 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å</h3>
    <label>–¢–∏–ø</label>
    <select id="itemType"><option value="photo">–§–æ—Ç–æ</option><option value="video">–í–∏–¥–µ–æ</option><option value="archive">–ê—Ä—Ö–∏–≤</option></select>
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
    <input id="itemTitle" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –û—Ç–ø—É—Å–∫ 2024)"/>
    <label>–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
    <textarea id="itemDesc" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ"></textarea>
    <div class="row">
      <div class="col">
        <label>–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª</label>
        <input id="itemUrl" type="text" placeholder="–í—Å—Ç–∞–≤—å URL –Ω–∞ Google Drive / pCloud / YouTube –∏ —Ç.–¥."/>
      </div>
      <div style="width:160px;">
        <label>–¢–µ–≥</label>
        <input id="itemTag" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –æ—Ç–ø—É—Å–∫"/>
      </div>
    </div>
    <div style="margin-top:10px; display:flex; gap:8px; justify-content:flex-end;">
      <button class="btn" id="saveItem">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="btn ghost" id="cancelItem">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<div id="modalView" class="modal hidden">
  <div class="card" id="viewCard">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 id="viewTitle">–ü—Ä–æ—Å–º–æ—Ç—Ä</h3>
      <div>
        <button class="btn ghost" id="btnDownload">–°–∫–∞—á–∞—Ç—å</button>
        <button class="btn ghost" id="btnCloseView">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
    <div id="viewBody" style="margin-top:12px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div id="viewDesc" class="small" style="margin-top:8px;"></div>
  </div>
</div>

<input id="importFile" type="file" accept=".json" style="display:none;">

<script>
// Simple client-side app storing data in localStorage. No data leaves your browser.
// Data structure: {photos:[], videos:[], archive:[], settings:{passwordHash:...}}
// Utility
function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,8); }
function saveDB(db){ localStorage.setItem('elamanovich_db', JSON.stringify(db)); }
function loadDB(){ const raw = localStorage.getItem('elamanovich_db'); if(!raw) return {photos:[], videos:[], archive:[], settings:{}}; try{return JSON.parse(raw);}catch(e){return {photos:[], videos:[], archive:[], settings:{}};} }
function hash(s){ let h=2166136261; for(let i=0;i<s.length;i++){ h ^= s.charCodeAt(i); h = Math.imul(h, 16777619); } return (h>>>0).toString(16); }

// Auth (client-side)
let db = loadDB();
function showLock(){ document.getElementById('modalLock').classList.remove('hidden'); }
function hideLock(){ document.getElementById('modalLock').classList.add('hidden'); }
function isLocked(){ const pwSet = db.settings && db.settings.passwordHash; if(!pwSet) return true; const entered = sessionStorage.getItem('el_pw'); return entered !== db.settings.passwordHash; }

function initAuth(){
  if(!db.settings) db.settings = {};
  if(!db.settings.passwordHash){
    showLock();
    document.getElementById('pwSave').onclick = ()=>{
      const v = document.getElementById('pwInput').value.trim();
      if(!v){ alert('–ü—Ä–∏–¥—É–º–∞–π –ø–∞—Ä–æ–ª—å'); return; }
      db.settings.passwordHash = hash(v);
      saveDB(db); sessionStorage.setItem('el_pw', db.settings.passwordHash); hideLock(); renderAll(); updateStatus();
    };
    document.getElementById('pwCancel').onclick = ()=>{ alert('–ü–∞—Ä–æ–ª—å –Ω–µ –∑–∞–¥–∞–Ω. –ó–∞–∫—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –≤—ã–π—Ç–∏.'); };
  } else {
    if(isLocked()){
      showLock();
      document.getElementById('pwSave').onclick = ()=>{
        const v = document.getElementById('pwInput').value.trim();
        if(hash(v) === db.settings.passwordHash){ sessionStorage.setItem('el_pw', db.settings.passwordHash); hideLock(); renderAll(); updateStatus(); } else { alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å'); }
      };
      document.getElementById('pwCancel').onclick = ()=>{ alert('–í—ã–π–¥–∏ –∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —á—Ç–æ–±—ã –Ω–µ –≤–æ–π—Ç–∏.'); };
    } else {
      hideLock();
    }
  }
}

function updateStatus(){ document.getElementById('userStatus').textContent = isLocked() ? 'üîí –ó–∞–∫—Ä—ã—Ç–æ' : 'üîì –û—Ç–∫—Ä—ã—Ç–æ'; }

// Rendering
function renderGrid(list, containerId, type){
  const c = document.getElementById(containerId);
  c.innerHTML = '';
  list.forEach(item=>{
    const d = document.createElement('div'); d.className='thumb';
    const img = document.createElement('img');
    if(type==='photo'){
      img.src = item.thumb || item.url;
    } else {
      img.src = item.thumb || 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width=\"400\" height=\"300\"><rect width=\"100%\" height=\"100%\" fill=\"%23f3f4f6\"/><text x=\"50%\" y=\"50%\" dominant-baseline=\"middle\" text-anchor=\"middle\" fill=\"%236b7280\" font-size=\"20\">–í–∏–¥–µ–æ</text></svg>';
    }
    img.onerror = ()=>{ img.src = 'data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"300\"><rect width=\"100%\" height=\"100%\" fill=\"%23f3f4f6\"/><text x=\"50%\" y=\"50%\" dominant-baseline=\"middle\" text-anchor=\"middle\" fill=\"%236b7280\" font-size=\"18\">–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</text></svg>'; };
    d.appendChild(img);
    const t=document.createElement('div'); t.className='meta'; t.textContent = item.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
    d.appendChild(t);
    const tags=document.createElement('div'); tags.className='small'; tags.textContent = item.tag || '';
    d.appendChild(tags);
    d.onclick = ()=>{ openView(item); };
    c.appendChild(d);
  });
}

function renderAll(){
  db = loadDB();
  renderGrid(db.photos, 'photos', 'photo');
  renderGrid(db.videos, 'videos', 'video');
  renderGrid(db.archive, 'archive', 'archive');
  updateStatus();
}

// Modals & actions
document.getElementById('btnAddPhoto').onclick = ()=>{ openAddModal('photo'); };
document.getElementById('btnAddVideo').onclick = ()=>{ openAddModal('video'); };
document.getElementById('btnImport').onclick = ()=>{ document.getElementById('importFile').click(); };
document.getElementById('btnExport').onclick = ()=>{ exportJSON(); };
document.getElementById('btnClear').onclick = ()=>{ if(confirm('–ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ?')){ localStorage.removeItem('elamanovich_db'); db = {photos:[], videos:[], archive:[], settings:{}}; renderAll(); alert('–û—á–∏—â–µ–Ω–æ'); } };
document.getElementById('btnSettings').onclick = ()=>{ alert('–ü–∞—Ä–æ–ª—å –∏ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–≤–æ—ë–º –±—Ä–∞—É–∑–µ—Ä–µ. –î–µ–ª–∞–π —ç–∫—Å–ø–æ—Ä—Ç JSON –∫–∞–∫ –±—ç–∫–∞–ø.'); };

document.getElementById('importFile').addEventListener('change', (e)=>{
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=>{
    try{
      const obj = JSON.parse(reader.result);
      if(confirm('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ?')){ localStorage.setItem('elamanovich_db', JSON.stringify(obj)); db = loadDB(); renderAll(); alert('–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω'); }
    }catch(err){ alert('–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–∞–π–ª'); }
  };
  reader.readAsText(f);
});

function openAddModal(type){
  document.getElementById('modalAdd').classList.remove('hidden');
  document.getElementById('modalTitle').textContent = type==='photo'?'–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ': '–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ';
  document.getElementById('itemType').value = type;
  document.getElementById('itemTitle').value=''; document.getElementById('itemDesc').value=''; document.getElementById('itemUrl').value=''; document.getElementById('itemTag').value='';
}

document.getElementById('cancelItem').onclick = ()=>{ document.getElementById('modalAdd').classList.add('hidden'); };
document.getElementById('saveItem').onclick = ()=>{
  const type = document.getElementById('itemType').value;
  const title = document.getElementById('itemTitle').value.trim() || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
  const desc = document.getElementById('itemDesc').value.trim();
  const url = document.getElementById('itemUrl').value.trim();
  const tag = document.getElementById('itemTag').value.trim();
  if(!url){ alert('–í—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª –≤ –æ–±–ª–∞–∫–µ'); return; }
  const item = {id: uid(), title, desc, url, tag, thumb: url};
  if(type==='photo'){ db.photos.unshift(item); } else if(type==='video'){ db.videos.unshift(item); } else { db.archive.unshift(item); }
  saveDB(db); renderAll(); document.getElementById('modalAdd').classList.add('hidden');
};

function openView(item){
  document.getElementById('modalView').classList.remove('hidden');
  document.getElementById('viewTitle').textContent = item.title || '–ü—Ä–æ—Å–º–æ—Ç—Ä';
  const body = document.getElementById('viewBody'); body.innerHTML='';
  // if video (youtube or direct mp4) embed, else image
  if(item.url.match(/youtube\.com|youtu\.be/)){
    // embed YouTube
    const id = (item.url.match(/v=([^&]+)/) || item.url.match(/youtu\.be\/([^?]+)/) || [])[1] || item.url;
    const iframe = document.createElement('iframe'); iframe.width='100%'; iframe.height='480'; iframe.src = 'https://www.youtube.com/embed/' + id; iframe.frameBorder=0; iframe.allow='accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture'; iframe.allowFullscreen=true;
    body.appendChild(iframe);
  } else if(item.url.match(/\.(mp4|mov|webm)(\?|$)/i) || item.url.includes('drive.google.com')){
    // try video tag or Google Drive preview
    if(item.url.includes('drive.google.com')){
      // convert drive share link to preview embed if possible
      const m = item.url.match(/\/d\/([^/]+)\//);
      const id = m ? m[1] : (item.url.match(/id=([^&]+)/) || [])[1];
      if(id){
        const iframe = document.createElement('iframe'); iframe.width='100%'; iframe.height='480'; iframe.src = 'https://drive.google.com/file/d/' + id + '/preview'; iframe.frameBorder=0; iframe.allowFullscreen=true; body.appendChild(iframe);
      } else {
        const v = document.createElement('video'); v.controls=true; v.src = item.url; v.style.width='100%'; body.appendChild(v);
      }
    } else {
      const v = document.createElement('video'); v.controls=true; v.src = item.url; v.style.width='100%'; body.appendChild(v);
    }
  } else {
    const img = document.createElement('img'); img.src = item.url; img.style.maxWidth='100%'; img.style.borderRadius='8px'; body.appendChild(img);
  }
  document.getElementById('viewDesc').textContent = item.desc || '';
  document.getElementById('btnDownload').onclick = ()=>{ window.open(item.url, '_blank'); };
}

document.getElementById('btnCloseView').onclick = ()=>{ document.getElementById('modalView').classList.add('hidden'); };

// Export JSON
function exportJSON(){
  const data = loadDB();
  const blob = new Blob([JSON.stringify(data)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'elamanovich-backup.json'; a.click();
  URL.revokeObjectURL(url);
}

// Search
document.getElementById('search').addEventListener('input', (e)=>{
  const q = e.target.value.toLowerCase().trim();
  const filter = (list)=> list.filter(it => (it.title+ ' ' + (it.desc||'') + ' ' + (it.tag||'')).toLowerCase().includes(q));
  renderGrid(filter(db.photos), 'photos', 'photo');
  renderGrid(filter(db.videos), 'videos', 'video');
  renderGrid(filter(db.archive), 'archive', 'archive');
});

// Initial render & auth
initAuth();
renderAll();

// Safety note for user
console.log('Elamanovich: –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–≤–æ—ë–º –±—Ä–∞—É–∑–µ—Ä–µ (localStorage). –î–µ–ª–∞–π —ç–∫—Å–ø–æ—Ä—Ç JSON –∫–∞–∫ –±—ç–∫–∞–ø.');
</script>
</body>
</html>
